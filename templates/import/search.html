<section id="recherche">
    <!--À incorporer le système de recherche-->
    <nav id="filtres">
        <div id="search-bar">
            <form id="search-form" action="./globalSearch" role="search" method="post">
                <div id="search">
                    <label id="filters-used">
                    </label>
                    <span id="search-input">
                        <label for="input-search"></label><input autocomplete="off" id="input-search" type="search"
                                                                 name="searchValue"
                                                                 placeholder="Rechercher..." autofocus
                                                                 required/>
                    </span>
                    <span id="search-validation">
                        <button id="search-button" type="submit">Valider</button>
                    </span>

                </div>

                <ul id="search-suggestions"></ul>
            </form>
        </div>
        <ul>
            <li>
                <div id="search-presidence" class="filter">PRESIDENCE</div>
            </li>
            <li>
                <div id="search-assistance" class="filter">ASSISTANCE</div>
            </li>
            <li>
                <div id="search-communication" class="filter">COMMUNICATION</div>
            </li>
            <li>
                <div id="search-rh" class="filter">RESOURCES HUMAINES</div>
            </li>
            <li>
                <div id="search-finance" class="filter">FINANCE</div>
            </li>
            <li>
                <div id="search-marketing" class="filter">MARKETING</div>
            </li>
            <li>
                <div id="search-informatique" class="filter">INFORMATIQUE</div>
            </li>
        </ul>
    </nav>
</section>
<script>
    const suggestions = [
        {% for suggestion in suggestions %}
            "{{ suggestion }}",
        {% endfor %}
    ];

    const searchInput = document.getElementById("input-search");
    const searchSuggestions = document.getElementById("search-suggestions");

    searchInput.addEventListener("input", function () {
        searchSuggestions.innerHTML = "";
        if (searchInput.value.length > 0) {
            // if the input contains only alphabetical characters
            // search for suggestions that start with the input value
            if (/^[a-zA-Z]+$/.test(searchInput.value)) {
                suggestions.forEach(suggestion => {
                    if (suggestion.toLowerCase().startsWith(searchInput.value.toLowerCase())) {
                        const suggestionElement = document.createElement("li");
                        suggestionElement.innerHTML = `<a href="./profile?user=${suggestion}">${suggestion}</a>`;
                        searchSuggestions.appendChild(suggestionElement);
                    }
                });
            }
            // if the input contains * characters
            // if *a search for suggestions that end with a
            if (searchInput.value.startsWith("*")) {
                suggestions.forEach(suggestion => {
                    if (suggestion.toLowerCase().endsWith(searchInput.value.substring(1).toLowerCase())) {
                        const suggestionElement = document.createElement("li");
                        suggestionElement.innerHTML = `<a href="./profile?user=${suggestion}">${suggestion}</a>`;
                        searchSuggestions.appendChild(suggestionElement);
                    }
                });
            }
            // if (any alphabetic letter + "*" Character) and end with (any alphabetic letter) search for suggestions
            // that start with (the character(s) and end with the name that start with (the character(s))
            if (searchInput.value.startsWith(/[a-zA-Z]+/) && searchInput.value.endsWith(/[a-zA-Z]+/)) {
                suggestions.forEach(suggestion => {
                    if (suggestion.toLowerCase().startsWith(searchInput.value.substring(1, searchInput.value.length - 1).toLowerCase())) {
                        const suggestionElement = document.createElement("li");
                        suggestionElement.innerHTML = `<a href="./profile?user=${suggestion}">${suggestion}</a>`;
                        searchSuggestions.appendChild(suggestionElement);
                    }
                });
            }
        }
    });


    const form = document.getElementById('search-form');

    form.addEventListener('submit', () => {
        const filtersUsedLabel = document.querySelector('#filters-used');
        const filtersUsedText = filtersUsedLabel.textContent;
        const filtersUsedValues = filtersUsedText.split('❌').map(value => value.trim()).filter(value => value.length > 0);
        const filtersUsedInput = document.createElement('input');
        filtersUsedInput.type = 'hidden';
        filtersUsedInput.name = 'filtersUsed';
        filtersUsedInput.value = JSON.stringify(filtersUsedValues);
        form.appendChild(filtersUsedInput);
    });

    console.log(suggestions);
</script>